/* empty css             *//* empty css                     *//* empty css                *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css              */import{r as m}from"./request-54d9b062.js";import{r as N,o as d,c as p,b as n,y as i,t as c,d as l,w as a,C as _,D as B,T as O,J as I,F,z as U,f as y,U as z,V as D,W as J,X as $,Y as q,L as A,H}from"./index-fdd1b0eb.js";const M={class:"card",style:{"margin-bottom":"5px"}},R={key:0},W={style:{display:"flex","align-items":"center"}},X={style:{flex:"1"}},Y={style:{"margin-right":"10px"}},j={style:{color:"#3BB201"}},G={key:1,style:{color:"#666"}},K={class:"card"},P=["src"],Q={style:{margin:"5px",color:"#000","font-size":"18px",display:"flex","align-items":"center"}},Z={style:{flex:"1"}},ee={style:{color:"red","font-weight":"bold"}},te={style:{margin:"5px",color:"#666"}},oe={class:"line1"},se={key:1},le={style:{margin:"10px 0","text-align":"right"}},ne={style:{"text-align":"right",color:"red","font-weight":"bold","font-size":"20px","margin-top":"10px"}},ae={class:"dialog-footer"},be={__name:"Order",setup(re){const e=N({table:{},user:JSON.parse(localStorage.getItem("canteen-user")||"{}"),foodsList:[],dialogShow:!1,orderList:[],total:0,orderTotal:0}),f=()=>{m.get("/tables/selectByUserId/"+e.user.id).then(o=>{e.table=o.data||{}})};f();const b=()=>{m.put("/tables/removeTable",e.table).then(o=>{o.code==="200"?(_.success("退桌成功"),f()):_.error(o.msg)})};(()=>{m.get("/foods/selectAll").then(o=>{e.foodsList=o.data||[],e.foodsList.forEach(r=>r.num=1)})})();const v=()=>{e.dialogShow=!0},x=o=>{let r=e.orderList.find(t=>t.id===o.id);if(r)r.num+=o.num;else{let t=JSON.parse(JSON.stringify(o));e.orderList.push(t)}e.total=e.orderList.map(t=>t.num).reduce((t,g)=>t+g,0),e.orderTotal=0,e.orderList.forEach(t=>{e.orderTotal+=t.price*t.num}),e.orderTotal.toFixed(),_.success("加入购物车成功！")},w=()=>{if(e.orderList.length===0){_.warning("请选择餐品");return}let o="";e.orderList.forEach(t=>{o+=t.name+"x"+t.num+"，"}),o=o.substring(0,o.length-1);let r={content:o,total:e.orderTotal,userId:e.user.id,status:"待出餐",tableId:e.table.id,userName:e.user.name};m.post("/orders/add",r).then(t=>{t.code==="200"?(_.success("下单成功，请在我的订单里查看订单状态"),e.dialogShow=!1):_.error(t.msg)})};return(o,r)=>{const t=B,g=z,k=D,L=J,E=$,T=O,S=q,u=A,V=H,C=I;return d(),p("div",null,[n("div",M,[e.table.no?(d(),p("div",R,[n("div",W,[n("div",X,[n("span",Y,[i("餐桌号："),n("span",j,c(e.table.no),1),i(" 开始点餐")]),l(t,{type:"primary",plain:"",onClick:v},{default:a(()=>[i("购物车("+c(e.total)+")",1)]),_:1}),l(t,{type:"warning",onClick:b},{default:a(()=>[i("退桌")]),_:1})])])])):(d(),p("div",G,[i(" 您还未选餐桌，请先 "),l(t,{type:"info",plain:""},{default:a(()=>[l(g,{href:"/home",type:"info"},{default:a(()=>[i("选择餐桌")]),_:1})]),_:1}),i(" 再点餐 ")]))]),l(T,{gutter:10},{default:a(()=>[(d(!0),p(F,null,U(e.foodsList,s=>(d(),y(E,{span:6,key:s.id},{default:a(()=>[n("div",K,[n("img",{src:s.img,alt:"",style:{width:"100%",height:"280px"}},null,8,P),n("div",Q,[n("div",Z,c(s.name),1),n("div",ee,"￥"+c(s.price),1)]),n("div",te,[s.descr.length>=20?(d(),y(k,{key:0,content:s.descr,placement:"bottom",effect:"customized"},{default:a(()=>[n("div",oe,c(s.descr),1)]),_:2},1032,["content"])):(d(),p("div",se,c(s.descr),1))]),n("div",le,[l(L,{min:1,modelValue:s.num,"onUpdate:modelValue":h=>s.num=h,style:{"margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue"]),l(t,{type:"primary",onClick:h=>x(s)},{default:a(()=>[i("加入购物车")]),_:2},1032,["onClick"])])])]),_:2},1024))),128))]),_:1}),l(C,{modelValue:e.dialogShow,"onUpdate:modelValue":r[1]||(r[1]=s=>e.dialogShow=s),title:"购物车",width:"800"},{footer:a(()=>[n("div",ae,[l(t,{onClick:r[0]||(r[0]=s=>e.dialogShow=!1)},{default:a(()=>[i("关闭")]),_:1}),l(t,{type:"primary",onClick:w},{default:a(()=>[i("结算")]),_:1})])]),default:a(()=>[l(V,{data:e.orderList},{default:a(()=>[l(u,{label:"餐品图片"},{default:a(s=>[l(S,{style:{width:"50px",height:"50px"},src:s.row.img,"preview-src-list":[s.row.img],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),l(u,{prop:"name",label:"餐品名称"}),l(u,{prop:"price",label:"餐品价格"}),l(u,{prop:"num",label:"餐品数量"})]),_:1},8,["data"]),n("div",ne,"总价：￥"+c(e.orderTotal),1)]),_:1},8,["modelValue"])])}}};export{be as default};
